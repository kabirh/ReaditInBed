<!DOCTYPE html>
<html>

<head>
  <meta charset="utf8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />

  <title>Reddit in Bed</title>

  <link rel="apple-touch-icon-precomposed" href="img/RnB_57.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/RnB_72.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/RnB_114.png">

  <link rel="stylesheet" href="css/style.css">
  <link id="size-stylesheet" rel="stylesheet" type="text/css" href="css/iphone.css">
  <link rel="stylesheet" media="screen and (min-device-width: 700px)" href="css/ipad.css" />
  <link rel="stylesheet" href="css/add2home.css">

  <link href='http://fonts.googleapis.com/css?family=Average' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>

 <!-- start Mixpanel --><script type="text/javascript">(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.0.min.js';d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?
g=a[f]=[]:f="mixpanel";g.people=g.people||[];h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.set people.increment".split(" ");for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.1})(document,window.mixpanel||[]);
mixpanel.init("b8b029b5c74775454ad4d9932ceca8b8");</script><!-- end Mixpanel -->

  <!-- jQuery plugin that loads images when they come into view -->
  <!--<script src="js/jquery.lazyload.js?v=3" type="text/javascript" charset="utf-8"></script> -->
  <script src="js/jquery.lazyload.min.js" type="text/javascript" charset="utf-8"></script>
  <!-- jQuery plugin for touch friendly albums, not used in this version
  <script type="text/javascript" src="js/klass.min.js"></script>
  <script type="text/javascript" src="js/code.photoswipe-3.0.5.js"></script> -->
  <!-- jQuery plugin that truncates text when it gets too long -->
  <script src="js/jquery.dotdotdot-1.5.1.js" type="text/javascript"></script>
  <!-- Embedly jQuery plugin for embedding quickmeme links -->
  <script src="http://scripts.embed.ly/jquery.embedly.min.js" type="text/javascript"></script>
  
  <!-- Plugin adds the Add to Home Screen button for return users: http://cubiq.org/add-to-home-screen -->
  <script type="text/javascript">
    var addToHomeConfig = {
      autostart: false,
      returningVisitor: false,
      animationIn: 'fade',
      animationOut: 'fade',
      startDelay: 100000,
      lifespan:20000,
      touchIcon:true,
      message:'Hey! Add Reddit in Bed to your <strong>%device</strong> home screen. Just tap the %icon'
    };
  </script>
  <script type="application/javascript" src="js/add2home.js"></script>

  <script type="text/javascript" src="js/main.js"></script>

  <script type="text/javascript"  charset="utf-8">
    $(document).ready(function() {
      //addToHome.reset();
      
      launch();
      mixpanel.track("First Timer");
      _gaq.push(['_trackEvent', 'Loading', 'firstload', 'Initial Load']);


      /* I need to figure out how to make this work.
      if (localStorage.getItem('timestamp') === null) {
        launch();
        localStorage.setItem('timestamp', Math.round(new Date().getTime() / 1000));
        var f = $('#feed').html();
        localStorage.setItem('state', f);        
        console.log(f);
        mixpanel.track("First Timer");
        _gaq.push(['_trackEvent', 'Loading', 'firstload', 'Initial Load']);
      } else {
        var cur_time = localStorage.getItem('timestamp');
        console.log("Current time is: "+cur_time);
        console.log("Timestamp is: "+Math.round(new Date().getTime() / 1000));
        console.log("Diff is " + (cur_time - Math.round(new Date().getTime() / 1000)));
        console.log("State is " + (cur_time - Math.round(new Date().getTime() / 1000) < -60));
        if (cur_time - Math.round(new Date().getTime() / 1000) < -60) {
          console.log("Time diff is < -7200, refreshing");
          localStorage.setItem('timestamp', Math.round(new Date().getTime() / 1000));
          launch();
          mixpanel.track("Landed");
          _gaq.push(['_trackEvent', 'Loading', 'return', 'Return Load']);
          var f = $('#feed').html();
          console.log(f);
          localStorage.setItem('state', f);
        } else {
          console.log("Time diff is short, trying to restore");
          localStorage.setItem('timestamp', Math.round(new Date().getTime() / 1000));
          mixpanel.track("Return");
          console.log(localStorage.getItem('state'));
          $('#feed').html(localStorage.getItem('state'));
          _gaq.push(['_trackEvent', 'Loading', 'firstload', 'Initial Load']);
        }
      }
      */


      // var myPhotoSwipe = $("#Gallery a").photoSwipe({ enableMouseWheel: false , enableKeyboard: false });

      // Infinite scroll function, loads the next page at 80 pixels from the bottom
      $(window).scroll(function () {
         if ($(window).scrollTop() >= $(document).height() - $(window).height() - 80) {
            getFeed(nextUrl);
         }
      
        $('.content.embed').embedly({
          width: 740,
          key: 'c2ad2e2d67a24dd0907a335f0691817f'
        });
      });
      
    });
  </script>

  <style></style>

</head>

<body>
<div id="container">
    
    <div id="info">
      <img src="img/header.png">
      <div class="post"><header>Reddit in Bed</header>
        <h8>An easy way to Reddit. Just scroll down. <a href="about.html">More info..</a></h8>
        <br>
        <br>
        <script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script>
        <!-- AddThis Button BEGIN -->
        <div class="addthis_toolbox addthis_default_style addthis_16x16_style">
        <a class="addthis_button_email"></a>
        <a class="addthis_button_twitter"></a>
        <a class="addthis_button_tumblr"></a>
        <a class="addthis_button_google_plusone_share"></a>
        <a class="addthis_button_facebook"></a>
        <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
        </div>
        <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5211595b4fbd04cf"></script>
        <!-- AddThis Button END -->
        <br>
      </div>
    </div>
    <div id="feed">
    </div>
    <div class="loadmore">
      <img src="img/loading3.gif">Loading more..
    </div>
</div>

<script>

$('#loadmore').click(function() {
    _gaq.push(['_trackEvent', 'Loading', 'loadmore', 'loadedmore']);
    addToHome.show();
    getFeed(nextUrl);
});

</script>

<script type="text/javascript">

function loaded () {
  if ( window.location.hash.match('ATHS') ) return;

  addToHome.show();
  window.location.hash = '#ATHS';
}

window.addEventListener('load', loaded, false);

</script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33133953-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
</html>